import{m as _}from"./QDialog.eb5986ff.js";import{a as v,Q as A}from"./QTable.8e0fe829.js";import{Q as w,a as y}from"./QTd.ec8175d6.js";import{r as E,E as c,P as u,K as s,G as i,F as p,T as k,R as F,O as b,Q as I,L as d,M as P}from"./index.f77abd2b.js";import{c as S,b as T}from"./QCard.cba0760b.js";import{i as q,g as N,e as O}from"./especifica-controller.1a8a6627.js";import"./downloadPdf.508fda78.js";const B={class:"q-ma-md"},L=d("div",{class:"row justify-between"},[d("div",{class:"col-9"},[d("div",{class:"col q-table__title",inline:""},[d("b",null,"Historial de informes")])])],-1),K=d("div",{class:"col q-table__title"},[d("b",null,"Lista de Informes")],-1),J={__name:"MainPage",setup(M){const g=T(),C=[{name:"periodo",label:"Periodo",sortable:!0,field:"periodo",align:"left"},{name:"informe",label:"Informe",sortable:!0,field:"informe",align:"center",style:"max-width: 400px; white-space: break-spaces;"},{name:"fechaInicio",label:"Fecha Inicial",sortable:!1,field:"fechaInicio",align:"center"},{name:"fechaFin",label:"Fecha Final",sortable:!1,field:"fechaFin",align:"center"}],f=E([]),Q=async()=>{await q.obtenerTodosInformes(t=>{console.log(t.data);const e=t.data.informes;f.value=[];for(let a=0;a<e.length;a++)e[a].periodoAcademico.estado||f.value.push({periodo:e[a].periodoAcademico.nombre,fechaInicio:new Date(e[a].periodoAcademico.fechaInicio).toLocaleDateString(),fechaFin:new Date(e[a].periodoAcademico.fechaFin).toLocaleDateString(),informe:e[a].formato.nombreFormato,id:e[a]._id,idformato:e[a].formato._id})})};async function D(t){console.log(t);const e=await x(t.id);console.log(e),N.generarPDF(t.id,e,t.periodo,t.idformato)}const x=async t=>{let e=[];await O.obtenerActividadesPorInforme(t,o=>{if(o.status==401)return h("NO OK",o.message),router.push({path:"/"});if(o.status!=200)return h("NO OK",o.message);const n=o.data.actividadesEspecificas;for(let r=0;r<n.length;r++){let l=!1;for(let m=0;m<e.length;m++)e[m].nombre==n[r].actividadDistributivo.funcionSustantiva.nombre&&(l=!0);(r==0||!l)&&e.push({nombre:n[r].actividadDistributivo.funcionSustantiva.nombre,actividadesEspecificas:[]})}for(let r=0;r<n.length;r++)for(let l=0;l<e.length;l++)n[r].actividadDistributivo.funcionSustantiva.nombre==e[l].nombre&&e[l].actividadesEspecificas.push(n[r])});function a(o,n){return o.nombre<n.nombre?-1:o.nombre>n.nombre?1:0}return e.sort(a)};Q();const h=(t,e)=>{t=="OK"?g.notify({color:"green-5",textColor:"white",icon:"mdi-check-bold",message:e}):g.notify({color:"red-5",textColor:"white",icon:"warning",message:e})};return(t,e)=>(c(),u("div",B,[s(S,{class:"my-card"},{default:i(()=>[s(_,{class:"card-title-gestionar"},{default:i(()=>[L]),_:1}),s(_,{class:"bg-blue-1"},{default:i(()=>[(c(),p(A,{columns:C,rows:f.value,"row-key":"name","no-data-label":"No posee un historial de informes",key:"tablePeriodo",pagination:{rowsPerPage:10},"rows-per-page-label":"Resultados por p\xE1gina"},{top:i(()=>[K]),header:i(a=>[s(w,{props:a},{default:i(()=>[(c(!0),u(k,null,F(a.cols,o=>(c(),p(v,{key:o.name,props:a},{default:i(()=>[b(P(o.label),1)]),_:2},1032,["props"]))),128)),s(v,{"auto-width":""},{default:i(()=>[b("Acciones")]),_:1})]),_:2},1032,["props"])]),body:i(a=>[s(w,{props:a},{default:i(()=>[(c(!0),u(k,null,F(a.cols,o=>(c(),p(y,{key:o.name,props:a},{default:i(()=>[b(P(o.value),1)]),_:2},1032,["props"]))),128)),s(y,{align:"center","auto-width":"",class:"q-pa-md q-gutter-xs"},{default:i(()=>[s(I,{size:"sm",color:"orange",round:"",dense:"",onClick:o=>t.confirmacionEliminarPeriodo(a.row),icon:"mdi-eye-outline"},null,8,["onClick"]),s(I,{size:"sm",color:"positive",round:"",dense:"",icon:"mdi-download",onClick:o=>D(a.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows"]))]),_:1})]),_:1})]))}};export{J as default};
